# build-plugin

ä¸€ä¸ªç”¨äºä¼˜åŒ–å‰ç«¯é¡¹ç›®æ„å»ºæµç¨‹çš„ Node.js æ’ä»¶ï¼Œæä¾›ç‰ˆæœ¬å·ç®¡ç†å’Œæ„å»ºæ–‡ä»¶æ‰“åŒ…åŠŸèƒ½ã€‚ï¼ˆå½“å‰viteé¡¹ç›®äº²æµ‹å¯ç”¨ï¼Œç”±äºä½œè€…æ²¡æœ‰webpackå’Œrollupé¡¹ç›®ï¼Œæ²¡å‘æµ‹è¯•ï¼‰

## ä½¿ç”¨åœºæ™¯

### 1. å‰ç«¯é¡¹ç›®ç‰ˆæœ¬ç®¡ç†

åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°è¿™æ ·çš„åœºæ™¯ï¼š
- æ¯æ¬¡å‘å¸ƒæ–°åŠŸèƒ½éƒ½éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ package.json ä¸­çš„ç‰ˆæœ¬å·
- å›¢é˜Ÿæˆå‘˜å¯¹ç‰ˆæœ¬å·çš„ä¿®æ”¹è§„åˆ™ç†è§£ä¸ä¸€è‡´
- å¿˜è®°æ›´æ–°ç‰ˆæœ¬å·å¯¼è‡´çº¿ä¸Šç‰ˆæœ¬æ··ä¹±

ä½¿ç”¨ build-plugin åï¼š
- åœ¨æ„å»ºæ—¶è‡ªåŠ¨æç¤ºæ›´æ–°ç‰ˆæœ¬å·
- ç»Ÿä¸€çš„è¯­ä¹‰åŒ–ç‰ˆæœ¬ç®¡ç†
- ç‰ˆæœ¬å·å˜æ›´å†å²å¯è¿½è¸ª

### 2. è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹

ä¼ ç»Ÿçš„éƒ¨ç½²æµç¨‹é€šå¸¸æ˜¯ï¼š
1. æœ¬åœ°æ‰§è¡Œæ„å»ºå‘½ä»¤
2. æ‰‹åŠ¨å°† dist ç›®å½•æ‰“åŒ…æˆ ZIP
3. æ‰‹åŠ¨æ·»åŠ ç‰ˆæœ¬å·åˆ°å‹ç¼©åŒ…
4. å‘é€ç»™è¿ç»´è¿›è¡Œéƒ¨ç½²

ä½¿ç”¨ build-plugin åï¼š
1. æ‰§è¡Œ `npm run build` ä¸€é”®å®Œæˆæ‰€æœ‰æ­¥éª¤
2. è‡ªåŠ¨ç”Ÿæˆå¸¦ç‰ˆæœ¬å·çš„ ZIP åŒ…
3. è¿ç»´å¯ä»¥ç›´æ¥è·å–åˆ°æ ‡å‡†åŒ–çš„éƒ¨ç½²åŒ…

## ç‰¹æ€§

- ğŸ”„ è‡ªåŠ¨åŒ–ç‰ˆæœ¬å·æ›´æ–°
  - åœ¨æ„å»ºå‰äº¤äº’å¼æ›´æ–°é¡¹ç›®ç‰ˆæœ¬å·
  - æ”¯æŒè¯­ä¹‰åŒ–ç‰ˆæœ¬å·ç®¡ç†

- ğŸ“¦ æ„å»ºæ–‡ä»¶æ‰“åŒ…
  - è‡ªåŠ¨å°†æ„å»ºäº§ç‰©æ‰“åŒ…æˆ ZIP æ–‡ä»¶
  - æ”¯æŒè‡ªå®šä¹‰è¾“å‡ºç›®å½•
  - ä¿ç•™ç‰ˆæœ¬ä¿¡æ¯çš„æ–‡ä»¶å‘½å

- ğŸ”Œ æ— ç¼é›†æˆ
  - æ”¯æŒä¸»æµæ„å»ºå·¥å…·ï¼ˆViteã€Webpack ç­‰ï¼‰
  - é€šè¿‡ npm scripts è½»æ¾é›†æˆ
  - æ”¯æŒè‡ªå®šä¹‰æ„å»ºå‘½ä»¤

## å®‰è£…

```bash
npm install @dwjem/build-plugin --save-dev
```

## ä½¿ç”¨æ–¹æ³•

### 1. é…ç½® package.json

åœ¨ä½ çš„é¡¹ç›®çš„ `package.json` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹è„šæœ¬ï¼š

```json
{
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "prebuild": "npx build-plugin prebuild",
    "postbuild": "npx build-plugin postbuild"
  }
}
```

### 2. æ‰§è¡Œæ„å»º

è¿è¡Œä»¥ä¸‹å‘½ä»¤å¼€å§‹æ„å»ºï¼š

```bash
npm run build
```

æ„å»ºè¿‡ç¨‹å°†è‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š
1. `prebuild`: æ›´æ–°ç‰ˆæœ¬å·
2. `build`: æ‰§è¡Œé¡¹ç›®æ„å»º
3. `postbuild`: æ‰“åŒ…æ„å»ºæ–‡ä»¶

### 3. è‡ªå®šä¹‰æ„å»ºå‘½ä»¤

å¦‚æœä½ ä½¿ç”¨è‡ªå®šä¹‰çš„æ„å»ºå‘½ä»¤ï¼ˆä¾‹å¦‚ `build:prod`ï¼‰ï¼Œéœ€è¦ç›¸åº”è°ƒæ•´ pre/post è„šæœ¬åç§°ï¼š

```json
{
  "scripts": {
    "build:prod": "vite build",
    "prebuild:prod": "npx build-plugin prebuild",
    "postbuild:prod": "npx build-plugin postbuild"
  }
}
```

> å‘½åè§„åˆ™ï¼špre<command> å’Œ post<command>

## é…ç½®é€‰é¡¹

### postbuild å‚æ•°

- `--output`: æŒ‡å®š ZIP æ–‡ä»¶çš„è¾“å‡ºç›®å½•
  - ç±»å‹ï¼š`string`
  - é»˜è®¤å€¼ï¼š`version-zip`
  - ç¤ºä¾‹ï¼š`npx build-plugin postbuild --output=dist`

## å·¥ä½œæµç¨‹

1. **prebuild é˜¶æ®µ**
   - äº¤äº’å¼æç¤ºæ›´æ–°ç‰ˆæœ¬å·
   - è‡ªåŠ¨æ›´æ–° package.json ä¸­çš„ç‰ˆæœ¬ä¿¡æ¯

2. **postbuild é˜¶æ®µ**
   - æ”¶é›†æ„å»ºäº§ç‰©
   - åˆ›å»ºå¸¦ç‰ˆæœ¬å·çš„ ZIP æ–‡ä»¶
   - ä¿å­˜åˆ°æŒ‡å®šç›®å½•

## æ³¨æ„äº‹é¡¹

- ç¡®ä¿é¡¹ç›®æ ¹ç›®å½•ä¸‹å­˜åœ¨ package.json æ–‡ä»¶
- ZIP æ–‡ä»¶åæ ¼å¼ä¸ºï¼š`<version>.zip`
- è¾“å‡ºç›®å½•ä¸å­˜åœ¨æ—¶ä¼šè‡ªåŠ¨åˆ›å»º

## è®¸å¯è¯

ISC License
